
/**
 * Copyright (C) 2018 bind-js Haitham Mubarak 
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @BindJS is an easy implementation for data binding either bidirectional or one-way direction.
 * 
 */
(function(){function f(c,b,e){Object.defineProperty(c,b,{value:e,writable:!1})}function t(c,b,e,a){if(a==m.TYPE.ATTRIBUTE)b=b.substring(1),c.setAttribute(b,e);else for(b=b.split("."),a=0;a<b.length;a++){var d=b[a];if(a==b.length-1)if("function"==typeof c[d])c[d](e);else"object"==typeof c[d]?Object.assign(c[d],JSON.parse(e)):c[d]=e;else c=c[d]}}function u(c,b){for(var e=p[this.bindPath]||[],a=0;a<e.length;a++){var d=e[a];t(d.dom,d.key,this.getValue(),d.bindType)}}function v(c,b){var e=b||c.getAttribute("bindjs-value");
e||(e="input"==c.tagName.toLowerCase()?"value":"innerText");return e}var q={},p={},m=function(c,b,e,a,d){for(var k={},l={},f=(c.getAttribute("bindjs-map")||"").split("|"),h=0;h<f.length;h++){var g=f[h],n=g.indexOf(":");n=-1==n?g.indexOf("="):n;if(-1!=n){var x=g.substring(0,n);g=g.substring(n+1);l[x]=g;k[g]=x}}var y=e.split(".");this.getValue=function(){if(b==m.TYPE.PROPERTY){var a=c;for(var d=0;d<y.length;d++)a=a[y[d]];a="function"==typeof a?a():a;a=a!=c?a:null}else a=c.getAttribute(e);return k.hasOwnProperty(a)?
k[a]:a};this.setValue=function(d){l.hasOwnProperty(d)&&(d=l[d]);d!=this.getValue()&&(t(c,e,d,b),c.dispatchEvent(new Event(a)))};var z=this;c.addEventListener(a,function(){u.apply(z,[])});u.apply(this,[]);this.dom=c;this.bindId=e;this.bindPath=d};m.TYPE={ATTRIBUTE:"attribute",PROPERTY:"property"};var r={context:function(c){var b=q;if("string"==typeof c)for(var e=c.split("."),a=0;a<e.length;a++)if(b=b[e[a]],!b)throw Error("Unable to get context for "+c);return b},registerBindReference:function(c,b){if(b=
b||c.getAttribute("bindjs-ref")){var e=b.split(":");if(1==e.length){var a=v(c,a);var d=e[0]}else 2<=e.length&&(a=e[0],d=e[1]);bindType=m.TYPE.PROPERTY;a.startsWith("@")&&(a=a.substring(1),bindType=m.TYPE.ATTRIBUTE);p[d]=p[d]||[];p[d].push({dom:c,key:a,bindType:bindType})}else throw Error("BindJS Reference is not defined.");},registerBind:function(c,b,e){var a="input"==c.tagName.toLowerCase()?"change":"DOMSubtreeModified";var d=v(c),k=c.getAttribute("bindjs-id");try{if(!b){if(!k)throw Error("Unable to register bind with empty bind id.");
for(;bindDomId.parentNode!=document;){var l=bindDomId.parentNode;l.hasAttribute("bindjs-id")&&(k=l.getAttribute("bindjs-id")+"."+k)}e=k;var w=k.split(".");b=q;for(l=0;l<w.length;l++){var h=w[l];b[h]||(b[h]={".":null});b=b[h]}}var g=m.TYPE.PROPERTY;d.startsWith("@")&&(g=m.TYPE.ATTRIBUTE,d=d.substring(1));f(b,"propertyNames",function(){return Object.keys(this.properties())});f(b,"properties",function(){for(var b={},a=Object.getOwnPropertyNames(this),c=0;c<a.length;c++){var d=a[c];this.isProperty(d)&&
(b[d]=!0)}return b});f(b,"isObject",function(){return 0<this.propertyNames().length});f(b,"isProperty",function(){return key&&!key.startsWith(".")&&"function"!=typeof this[key]});f(b,"dom",function(){return this["."].dom});f(b,"bindPath",function(){return this["."].bindPath});f(b,"foreach",function(){handler.apply(this,[]);for(var b in this.properties())this.isProperty(b)&&this[b].foreach(handler)});f(b,"val",function(){if(0!=arguments.length&&1!=arguments.length)throw Error("Expected one or zero arguments.");
if(0==arguments.length){if(this.isObject()){var b=function(a,c){for(var d in c.properties())if(c.isProperty(d)){var e=c[d];e.isObject()?(a[d]={},b(a[d],e)):a[d]=e.val()}},a={};b(a,this);return JSON.stringify(a)}return this["."].getValue()}a=arguments[0];if(this.isObject()){var c=function(a,b){for(var d in b.properties())if(b.isProperty(d)){var e=b[d];e.isObject()?c(a[d],e):e.val(a[d])}};a="object"==typeof a?a:JSON.parse(arguments[0]+"");c(a,this)}else this["."].setValue(a)});f(b,".",new m(c,g,d,a,
e))}catch(n){throw console.log("Error at bind id :",k),n;}}};document.addEventListener("DOMContentLoaded",function(){function c(a,b,e){for(var d=0;d<a.children.length;d++){var h=a.children[d];if(h.hasAttribute("bindjs-id")){bindjsDomId=h.getAttribute("bindjs-id");f(b,bindjsDomId,{".":null});var g=e?e+"."+bindjsDomId:bindjsDomId;r.registerBind(h,b[bindjsDomId],g);c(h,b[bindjsDomId],g)}}}for(var b=document.body.querySelectorAll("[bindjs-ref]"),e=0;e<b.length;e++){var a=b[e];r.registerBindReference(a,
a.getAttribute("bindjs-ref"))}c(document.body,q,"")});window.BindJS=r})();
