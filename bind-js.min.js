
/**
 * Copyright (C) 2018 bind-js Haitham Mubarak 
 * 
 * The JavaScript code in this page is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 * 
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 * 
 * @BindJS is an easy implementation for data binding either bidirectional or one-way direction.
 * 
 */
(function(){function r(a,b,d){Object.defineProperty(a,b,{value:d,writable:!1})}function w(a,b,d,c){if(c==n.TYPE.ATTRIBUTE)a.setAttribute(b,d);else for(b=b.split("."),c=0;c<b.length;c++){var e=b[c];if(c==b.length-1)if("function"==typeof a[e])a[e](d);else"object"==typeof a[e]?Object.assign(a[e],JSON.parse(d)):a[e]=d;else a=a[e]}}function x(a,b){w(a.dom,a.key,b,a.bindType)}function t(a){if(!a){a=k.context(this.bindPath);for(var b=!1,d={name:"contextchange",original:a,stopPropagation:function(){b=!0}};null!=
a&&!b;){if("function"==typeof a.onchange)a.onchange(d);a="function"==typeof a._parentContext?a._parentContext():null}}a=l[this.bindPath]||[];for(d=0;d<a.length;d++)x(a[d],this.getValue())}function y(a){var b=n.TYPE.PROPERTY;a.startsWith("@")&&(a=a.substring(1),b=n.TYPE.ATTRIBUTE);return{key:a,type:b}}function z(a,b){var d=b||a.getAttribute("bindjs-value");d||(d="input"==a.tagName.toLowerCase()?"value":"innerText");return d}var A=/^[\-_a-zA-Z0-9]+$/,u={},l={},n=function(a,b,d,c,e){for(var h={},p={},
q=(a.getAttribute("bindjs-map")||"").split("|"),f=0;f<q.length;f++){var g=q[f],m=g.indexOf(":");m=-1==m?g.indexOf("="):m;if(-1!=m){var k=g.substring(0,m);g=g.substring(m+1);p[k]=g;h[g]=k}}var B=d.split(".");this.getValue=function(){if(b==n.TYPE.PROPERTY){var c=a;for(var e=0;e<B.length;e++)c=c[B[e]];c="function"==typeof c?c():c;c=c!=a?c:null}else c=a.getAttribute(d);return h.hasOwnProperty(c)?h[c]:c};this.setValue=function(c){p.hasOwnProperty(c)&&(c=p[c]);c!=this.getValue()&&(w(a,d,c,b),t.apply(l,
[!0]))};var l=this;a.addEventListener(c,function(){t.apply(l,[])});t.apply(this,[!0]);this.dom=a;this.bindId=d;this.bindPath=e};n.TYPE={ATTRIBUTE:"attribute",PROPERTY:"property"};var v=["onchange"],C={_parentContext:function(){var a=this.bindPath().replace(/(.*)\..+$/,"$1");return a!=this.bindPath()?k.context(a):null},_propertyNames:function(){return Object.keys(this._properties())},_properties:function(){for(var a={},b=Object.getOwnPropertyNames(this),d=0;d<b.length;d++){var c=b[d];this._isProperty(c)&&
(a[c]=!0)}return a},_isObject:function(){return 0<this._propertyNames().length},_isProperty:function(a){return a&&-1==v.indexOf(a)&&!a.startsWith(".")&&"function"!=typeof this[a]},dom:function(){return this["."].dom},bindPath:function(){return this["."].bindPath},foreach:function(){handler.apply(this,[]);for(var a in this._properties())this._isProperty(a)&&this[a].foreach(handler)},val:function(){if(0!=arguments.length&&1!=arguments.length)throw Error("Expected one or zero arguments.");if(0==arguments.length){if(this._isObject()){var a=
function(c,b){for(var d in b._properties())if(b._isProperty(d)){var e=b[d];e._isObject()?(c[d]={},a(c[d],e)):c[d]=e.val()}},b={};a(b,this);return JSON.stringify(b)}return this["."].getValue()}b=arguments[0];if(this._isObject()){var d=function(a,b){for(var c in b._properties())if(b._isProperty(c)){var e=b[c];e._isObject()?d(a[c],e):e.val(a[c])}};b="object"==typeof b?b:JSON.parse(arguments[0]+"");d(b,this)}else this["."].setValue(b)}};var k={context:function(a){var b=u;if("string"==typeof a)for(var d=
a.split("."),c=0;c<d.length;c++)if(b=b[d[c]],!b)throw Error("No context found for "+a);return b},registerBindReference:function(a,b){if(b=b||a.getAttribute("bindjs-ref")){var d=b.split(":");if(1==d.length){var c=z(a,c);var e=d[0]}else 2<=d.length&&(c=d[0],e=d[1]);c=y(c);d=c.type;c=c.key;l[e]=l[e]||[];c={dom:a,key:c,bindType:d};l[e].push(c);x(c,this.context(e).val())}else throw Error("BindJS Reference is not defined.");},registerBind:function(a,b,d){var c="input"==a.tagName.toLowerCase()?"change":
"DOMSubtreeModified";var e=z(a);try{var h=a.getAttribute("bindjs-id")||"";if(!h.match(A))throw Error('bindjs-id value "'+h+'" has wrong format. Values should match regex "'+A+'"');if(!b){if(!h)throw Error("Unable to register bind with empty bind id.");for(;bindDomId.parentNode!=document;){var p=bindDomId.parentNode;p.hasAttribute("bindjs-id")&&(h=p.getAttribute("bindjs-id")+"."+h)}d=h;var q=h.split(".");b=u;for(var f=0;f<q.length;f++){var g=q[f];b[g]||(b[g]={".":null});b=b[g]}}var m=y(e),k=m.type;
e=m.key;for(f=0;f<v.length;f++)b[v[f]]=null;for(var l in C)r(b,l,C[l]);r(b,".",new n(a,k,e,c,d))}catch(D){throw D;}}};document.addEventListener("DOMContentLoaded",function(){function a(b,c,d){for(var e=0;e<b.children.length;e++){var f=b.children[e];if(f.hasAttribute("bindjs-id")){bindjsDomId=f.getAttribute("bindjs-id");r(c,bindjsDomId,{".":null});var g=d?d+"."+bindjsDomId:bindjsDomId;k.registerBind(f,c[bindjsDomId],g);a(f,c[bindjsDomId],g)}else a(f,c,d)}}a(document.body,u,"");for(var b=document.body.querySelectorAll("[bindjs-ref]"),
d=0;d<b.length;d++){var c=b[d];k.registerBindReference(c,c.getAttribute("bindjs-ref"))}});window.BindJS=k})();
